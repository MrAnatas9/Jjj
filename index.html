<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>–ü–∏–Ω–≥-–ü–æ–Ω–≥ –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: none;
        }

        body {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: Arial, sans-serif;
            color: white;
            overflow: hidden;
            height: 100vh;
        }

        .screen {
            display: none;
            flex-direction: column;
            height: 100vh;
            padding: 20px;
            text-align: center;
        }

        .active {
            display: flex;
        }

        /* –≠–∫—Ä–∞–Ω –º–µ–Ω—é */
        .menu-screen {
            justify-content: center;
            align-items: center;
            gap: 30px;
        }

        .logo {
            font-size: 2.5em;
            margin-bottom: 20px;
        }

        .btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            width: 200px;
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.05);
        }

        /* –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã */
        .create-screen {
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .room-info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .room-link {
            font-size: 1.5em;
            font-weight: bold;
            color: #4CAF50;
            word-break: break-all;
            margin: 10px 0;
        }

        .waiting {
            font-size: 1.2em;
            margin: 20px 0;
        }

        /* –≠–∫—Ä–∞–Ω –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è */
        .join-screen {
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .input-group {
            margin: 20px 0;
        }

        input {
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid white;
            border-radius: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            width: 250px;
            text-align: center;
        }

        input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        /* –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω */
        .game-screen {
            padding: 10px;
        }

        .header {
            flex-shrink: 0;
            padding: 10px 0;
        }

        h1 {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .score {
            font-size: 2em;
            font-weight: bold;
            margin: 5px 0;
        }

        .status {
            font-size: 0.9em;
            padding: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            margin: 5px 0;
        }

        .game-area {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            max-width: 500px;
            max-height: 70vh;
            border: 2px solid white;
            border-radius: 15px;
            background: #000;
        }

        .controls {
            display: flex;
            justify-content: space-around;
            padding: 15px 0;
            flex-shrink: 0;
        }

        .touch-area {
            width: 45%;
            height: 120px;
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 0.8em;
            color: rgba(255,255,255,0.8);
        }

        .touch-area:active {
            background: rgba(255,255,255,0.3);
        }

        .touch-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .back-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
        }

        @media (max-height: 600px) {
            .touch-area {
                height: 80px;
            }
        }

        @media (orientation: landscape) {
            .game-screen {
                flex-direction: row;
            }
            
            .header {
                width: 25%;
            }
            
            .game-area {
                width: 50%;
            }
            
            .controls {
                width: 25%;
                flex-direction: column;
            }
            
            .touch-area {
                width: 100%;
                height: 45%;
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –º–µ–Ω—é -->
    <div id="menuScreen" class="screen active">
        <div class="menu-screen">
            <div class="logo">üéÆ –ü–∏–Ω–≥-–ü–æ–Ω–≥ üéÆ</div>
            <button class="btn" onclick="showScreen('createScreen')">–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É</button>
            <button class="btn" onclick="showScreen('joinScreen')">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã -->
    <div id="createScreen" class="screen">
        <div class="create-screen">
            <h1>–°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä—ã</h1>
            <div class="room-info">
                <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –¥—Ä—É–≥—É:</p>
                <div id="roomLink" class="room-link">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <div id="waitingText" class="waiting">–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...</div>
            <button class="btn" onclick="copyLink()">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É</button>
            <button class="back-btn" onclick="showScreen('menuScreen')">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è -->
    <div id="joinScreen" class="screen">
        <div class="join-screen">
            <h1>–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ –∏–≥—Ä–µ</h1>
            <div class="input-group">
                <input type="text" id="roomCodeInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∫–æ–º–Ω–∞—Ç—ã" maxlength="6">
            </div>
            <button class="btn" onclick="joinRoom()">–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è</button>
            <div id="joinStatus" class="status"></div>
            <button class="back-btn" onclick="showScreen('menuScreen')">‚Üê –ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
    <div id="gameScreen" class="screen">
        <div class="game-screen">
            <button class="back-btn" onclick="leaveGame()">‚Üê –í—ã–π—Ç–∏</button>
            
            <div class="header">
                <h1>üéÆ –ü–∏–Ω–≥-–ü–æ–Ω–≥ üéÆ</h1>
                <div class="score">
                    <span id="score1">0</span> - <span id="score2">0</span>
                </div>
                <div class="status" id="status">
                    –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...
                </div>
            </div>

            <div class="game-area">
                <canvas id="gameCanvas"></canvas>
            </div>

            <div class="controls">
                <div class="touch-area" id="upBtn">
                    <div class="touch-icon">‚¨ÜÔ∏è</div>
                    –í–í–ï–†–•
                </div>
                <div class="touch-area" id="downBtn">
                    <div class="touch-icon">‚¨áÔ∏è</div>
                    –í–ù–ò–ó
                </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        let currentRoomId = null;
        let playerId = null;

        // –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        const menuScreen = document.getElementById('menuScreen');
        const createScreen = document.getElementById('createScreen');
        const joinScreen = document.getElementById('joinScreen');
        const gameScreen = document.getElementById('gameScreen');
        const roomLinkElement = document.getElementById('roomLink');
        const waitingText = document.getElementById('waitingText');
        const roomCodeInput = document.getElementById('roomCodeInput');
        const joinStatus = document.getElementById('joinStatus');

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }

        // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
        function createRoom() {
            socket.emit('createRoom');
        }

        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
        function joinRoom() {
            const roomCode = roomCodeInput.value.trim().toUpperCase();
            if (roomCode.length === 6) {
                socket.emit('joinRoom', roomCode);
                joinStatus.textContent = '–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ...';
                joinStatus.style.background = 'rgba(255,255,255,0.1)';
            } else {
                joinStatus.textContent = '–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥';
                joinStatus.style.background = 'rgba(255,0,0,0.3)';
            }
        }

        // –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏
        function copyLink() {
            navigator.clipboard.writeText(roomLinkElement.textContent).then(() => {
                alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!');
            });
        }

        // –í—ã—Ö–æ–¥ –∏–∑ –∏–≥—Ä—ã
        function leaveGame() {
            socket.disconnect();
            socket.connect();
            showScreen('menuScreen');
            currentRoomId = null;
            playerId = null;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
        socket.on('roomCreated', (roomId) => {
            currentRoomId = roomId;
            const roomUrl = `${window.location.origin}/room/${roomId}`;
            roomLinkElement.textContent = roomUrl;
            showScreen('createScreen');
        });

        socket.on('playerAssigned', (data) => {
            playerId = data.playerId;
            currentRoomId = data.roomId;
            initializeGame(data.gameState);
            showScreen('gameScreen');
            
            if (playerId === 'player1') {
                document.getElementById('status').textContent = '–û–∂–∏–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ –∏–≥—Ä–æ–∫–∞...';
            } else {
                document.getElementById('status').textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è!';
            }
        });

        socket.on('playerJoined', (data) => {
            if (playerId === 'player1') {
                document.getElementById('status').textContent = '–ò–≥—Ä–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è! –ù–∞—á–∏–Ω–∞–µ–º...';
            }
            waitingText.textContent = `–ò–≥—Ä–æ–∫–æ–≤: ${data.playerCount}/2`;
        });

        socket.on('gameStart', (gameState) => {
            document.getElementById('status').textContent = '–ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!';
            initializeGame(gameState);
        });

        socket.on('roomNotFound', () => {
            joinStatus.textContent = '–ö–æ–º–Ω–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞';
            joinStatus.style.background = 'rgba(255,0,0,0.3)';
        });

        socket.on('roomFull', () => {
            joinStatus.textContent = '–ö–æ–º–Ω–∞—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞';
            joinStatus.style.background = 'rgba(255,0,0,0.3)';
        });

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ —Å—Å—ã–ª–∫–µ
        window.addEventListener('load', () => {
            const path = window.location.pathname.split('/');
            if (path[1] === 'room' && path[2]) {
                const roomId = path[2];
                socket.emit('joinRoom', roomId);
                showScreen('gameScreen');
            }
        });

        // –ò–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ (–∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –∫–æ–¥–∞)
        function initializeGame(initialState) {
            // –í–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ ...
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã –ø—Ä–∏ –∫–ª–∏–∫–µ
        document.querySelector('.btn').onclick = createRoom;
    </script>
</body>
                </html>
